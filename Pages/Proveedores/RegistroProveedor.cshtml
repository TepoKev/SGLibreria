@page
@model Proveedores.RegistroProveedorModel
@{
    ViewData["title"] = "Registro de Proveedor";
}
<div class="row pt-3">
    <form class="col-lg-8 offset-lg-2 rounded pt-4 pb-3 border border-secondary-100" method="post" id="frmProveedor">
        <div class="form-group row">
            <label asp-for="Proveedor.Nombre" class="col-lg-1 ml-5 col-form-label mr-4 font-weight-bold"></label>
            <div class="col-lg-9">
                <input type="text" class="form-control mb-2" asp-for="Proveedor.Nombre" placeholder="Ingrese un nombre">
            </div>
        </div>
        <div class="form-group row">
            <label asp-for="Proveedor.Correo" class="col-lg-1 ml-5 col-form-label mr-4 font-weight-bold"></label>
            <div class="col-lg-9">
                <input type="email" class="form-control mb-2" asp-for="Proveedor.Correo"
                    placeholder="ejemplo@dominio.com">
            </div>
        </div>
        <div class="form-group row">
            <label asp-for="Proveedor.Telefono" class="col-lg-1 ml-5 col-form-label mr-4 font-weight-bold"></label>
            <div class="col-lg-6">
                <select id="dynamic" class="custom-options">
                    <option value="">Seleccione...</option>
                </select>
            </div>
        </div>
        <div class="form-group row">
            <div class="row col-lg-9 offset-2">
                <input type="text" class="form-control col-lg-5 ml-3" id="add_val" name="add_val">
                <button id="bt_add_val" type="button" class="btn btn-outline-success ml-2"><i class="fas fa-plus"></i>
                    Agregar</button>
            </div>
        </div>
        <div class="form-group row">
            <label asp-for="Proveedor.Direccion" class="col-lg-1 ml-5 col-form-label mr-4 font-weight-bold"></label>
            <div class="col-lg-9">
                <textarea class="form-control mb-2" asp-for="Proveedor.Direccion" placeholder="4ta, avenida norte..."
                    style="height: 150px;"></textarea>
            </div>
        </div>
        <div class="row">
            <label asp-for="Proveedor.Enlace" class="col-lg-1 ml-5 col-form-label  mr-4 font-weight-bold"></label>
            <div class="form-group col-lg-9">
                <input class="form-control mb-2" asp-for="Proveedor.Enlace" placeholder="www.ejemplo.com">
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 offset-md-4">
                <div class="btn btn-group">
                    <button type="button" class="btn btn-outline-primary" id="registrar"><i class="fas fa-save"></i>
                        Registrar</button>
                    <button type="button" class="btn btn-outline-secondary"><i class="fas fa-times-circle"></i>
                        Cancelar</button>
                </div>
            </div>
        </div>
    </form>
    <div class="col-lg-2" id="notific">
        <div class="toast" id="toastProveedor" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <label class="col-form-label">
                    <i class="fas fa-check-circle text-success"></i>
                    <strong class="mr-auto">Registro Proveedor</strong>
                </label>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body">
                Registro Exitoso!
            </div>
        </div>
    </div>
</div>
@section Scripts
{
    <link href="~/selectric/src/selectric.css" rel="stylesheet">
    <script src="~/selectric/src/jquery.selectric.js"></script>
    <script>
        var numSel = {
            elemento:'',
            texto:''
        }
        var elementos = [numSel];
        var Telefonos = [];
        var Principal;
        elementos[elementos.length-1].elemento = '';
        elementos[elementos.length-1].texto = "Seleccione...";
        $('.custom-options').selectric({
            optionsItemBuilder: function (itemData, element, index) {
                return '<span>' + elementos[index].elemento + ' ' + elementos[index].texto + '</span>';
            }
        });
        function addlist(){
            var btnadd = document.getElementById("bt_add_val");
            btnadd.addEventListener("click", ()=>{
                var value = document.getElementById("add_val").value;
                if (value != "" && !Telefonos.includes(value)) {
                    Telefonos.push(value);
                    var numSel = {
                        elemento:'<i class="fas fa-trash text-danger ml-4"></i>',
                        texto: value
                    }
                    elementos.push(numSel)
                    var option = document.createElement('option');
                    option.value = value;
                    option.innerHTML = value;
                    var selTel = document.getElementById("dynamic").appendChild(option);
                    $('.custom-options').selectric({
                        optionsItemBuilder: function (itemData, element, index) {
                            return '<span>' + elementos[index].texto + elementos[index].elemento + '</span>';
                        }
                    });
                    escucharDel();
                }
            });
        }addlist();
        function escucharDel(){
            var idel = document.getElementsByClassName("fas fa-trash");
            for(var i = 0 ; i < idel.length ; i++){
                idel[i].addEventListener("click" , eliminar);
            }
            addlist();
        }
        function eliminar(e){
                var num = e.target.previousSibling;
                var numSel = {
                    elemento:'<i class="fas fa-trash text-danger ml-4"></i>',
                    texto: num
                }
                for(var i = 0 ; i < Telefonos.length ; i++){
                    if(Telefonos[i] == num){
                        Telefonos[i].splice(i, 1);
                        elementos[i].splice(i, 1);
                    }
                }
            }
        var BtnRegistrar = document.getElementById("registrar");
        BtnRegistrar.addEventListener("click", GuardarForAjax);
        function GuardarForAjax() {
            var xhttp = new XMLHttpRequest();
            let formData = new FormData(document.getElementById("frmProveedor"));
            formData.append("Principal",Principal);
            for(var i = 0; i < Telefonos.length; i++){
                formData.append("Telefonos[]", encodeURIComponent(Telefonos[i]));
            }
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var sel = document.getElementById("dynamic");
                    while (sel.firstChild) {
                        sel.removeChild(sel.firstChild);
                    }
                    $('#dynamic').selectric();
                    $('#dynamic').append('<option selected value ="">Seleccione...</option>');
                    $('#dynamic').selectric('refresh');
                    document.getElementById("frmProveedor").reset();
                    var toast = document.getElementById("toastProveedor");
                    toast.setAttribute("data-autohide","false");
                    $('.toast').toast('show');
                }
            };
            xhttp.open("POST", "RegistroProveedor", true);
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            var inputToken = document.getElementsByName("__RequestVerificationToken");
            xhttp.setRequestHeader("RequestVerificationToken", inputToken[0].value);
            xhttp.send(new URLSearchParams(formData));
        }
    </script>
}